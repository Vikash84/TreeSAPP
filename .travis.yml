sudo: true
language: python
python:
    - "3.6"
    - "3.5"

jobs:
  include:
    # perform a linux build
    - services: docker
    # and a mac build
    - os: osx
      language: shell

env:
  global:
    - TWINE_USERNAME=__token__
    # Note: TWINE_PASSWORD is set to a PyPI API token in Travis settings
    - PIP=python3 -m pip
    - TWINE_REPOSITORY=pypi
    - TWINE_REPOSITORY_URL=https://test.pypi.org/simple/

before_install:
  - sudo apt-get -y install gcc dpkg-dev curl zip git libz-dev default-jdk \
    python3 python3-distutils python3-dev
  - sudo apt-get install python3-pip -y
  - sudo apt-get install python-qt4 -y
  - sudo apt-get install python-lxml -y
  - sudo apt-get install python-six -y
  - wget https://mafft.cbrc.jp/alignment/software/mafft_7.407-1_amd64.deb
  - sudo dpkg -i mafft_7.407-1_amd64.deb

install:
    - $PIP install -r requirements.txt
    - $PIP install -U setuptools
    - $PIP install cibuildwheel==1.1.0
    - cibuildwheel --output-dir wheelhouse
    - python3 setup.py sdist --dist-dir wheelhouse

#before_script:
#    - cd /home/travis/build/hallamlab/TreeSAPP/sub_binaries; cp usearch /usr/bin; cd ../; make; make install

script:
    # build the wheels, put them into './wheelhouse'
    - python3 -m cibuildwheel --output-dir wheelhouse
    # - pytest

branches:
  only:
    - master
    - port

notifications:
    email: false

after_success:
  # if the release was tagged, upload them to PyPI
  - |
    if [[ $TRAVIS_TAG ]]; then
      $PIP install twine
      python3 -m twine upload --skip-existing wheelhouse/*.whl
    fi
